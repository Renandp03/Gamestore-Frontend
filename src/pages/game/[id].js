import styled from "styled-components"
import Head from 'next/head'
import { Screen } from ".."
import Header from "@/components/header"
import { useState, useEffect, useContext } from "react"
import { useRouter } from "next/router"
import axios from "axios"
import GamePerfil from "@/components/gamePerfil"
import { TokenContext } from "../../../contexts/tokenContext"

export default function gamePage(){
    const router = useRouter()
    const { id } = router.query;
    const [ gameInfo, setGameInfo ] = useState();
    const {userId} = useContext(TokenContext);


    function getGameInfo(){
        if(!id) return undefined;
        const URL = process.env.NEXT_PUBLIC_HOST;
        axios.get(`${URL}/games/${id}`)
        .then((res) => {
            setGameInfo(res.data);
        
        })
        .catch((err) => {console.log(err)})
    }


    useEffect(() => {getGameInfo()},[id])

    if(!gameInfo) return(<><img svg='assets/loading1.svg' alt='carregando'/></>);

    const {name, image, owner, platform} = gameInfo;
    console.log({owner,userId})


    return(
        <>
        <Head>
        <title>{name}</title>
        <meta name="description" content="Generated by create next app" />
        <meta name="viewport" content="width=device-width, initial-scale=1" />
        <link rel="icon" href="../../assets/logoIcon.svg" />
        </Head>
        <main>
            <Header/>
            <Screen>
                <GameSpace>
                    <GamePerfil name={name} image={image} platform={platform.name}/>
                    <GameInfo>
                        <p>Nome: <span>{name}</span></p>
                        <p>Console: <span>{platform.name}</span></p>
                        <p>Proprietario: <span>{owner.name}</span></p>
                       {owner.id !== userId &&  
                        <button>
                            Oferecer troca 
                            <img src="../../assets/right_arrow_icon.svg" />
                        </button>}
                    </GameInfo>
                </GameSpace>
            </Screen>
        </main>
       </>
    )
}

const GameSpace = styled.div`
    display: flex;
    padding: 30px 0px;
    align-items: flex-start;
`

const GameInfo = styled.div`
    color: white;
    padding: 10px 20px;

    p{
        font-size: 18px;
        font-weight: 500;
        margin-bottom: 15px;
    }
    span{
        font-size: 16px;
        font-weight: 400;
    }
    button{
        display: flex;
        align-items: center;
        font-size: 18px;
        color: #774801;
        background: #FFBB12;
        padding: 5px;
        border:none;
        border-radius: 8px;
        img{
            width:20px;
            margin-left: 5px;
        }
    }
`